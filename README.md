# Marketing-
## Спринт 26 - Проектный месяц: часть вторая (Маркетинг)

## Второй проектный месяц - задание Маркетинг
### Описание
Интернет-магазин собирает историю покупателей, проводит рассылки предложений итпланирует будущие продажи. Для оптимизации процессов надо выделить пользователей, которые готовы совершить покупку в ближайшее время.

### Цель
Предсказать вероятность покупки в течение 90 дней

### Задачи
● Изучить данные\
● Разработать полезные признаки\
● Создать модель для классификации пользователей\
● Улучшить модель и максимизировать метрику roc_auc\
● Выполнить тестирование
### Данные

#### apparel-purchases история покупок
● client_id идентификатор пользователя\
● quantity количество товаров в заказе\
● price цена товара\
● category_ids вложенные категории, к которым отнсится товар\
● date дата покупки\
● message_id идентификатор сообщения из рассылки

#### apparel-messages история рекламных рассылок
● bulk_campaign_id идентификатор рекламной кампании\
● client_id идентификатор пользователя\
● message_id идентификатор сообщений\
● event тип действия\
● channel канал рассылки\
● date дата рассылки\
● created_at точное время создания сообщения

#### apparel-target_binary совершит ли клиент покупку в течение следующих 90 дней
● client_id идентификатор пользователя\
● target целевой признак

#### full_campaign_daily_event Агрегация общей базы рассылок по дням и типам событий
● date дата\
● bulk_campaign_id идентификатор рассылки\
● count_event* общее количество каждого события event\
● nunique_event* количество уникальных client_id в каждом событии\
* в именах колонок найдете все типы событий event

#### full_campaign_daily_event_channel Агрегация по дням с учетом событий и каналов рассылки
● date дата\
● bulk_campaign_id идентификатор рассылки\
● count_event*_channel* общее количество каждого события по каналам\
● nunique_event*_channel* количество уникальных client_id по событиям и каналам\
* в именах колонок есть все типы событий event и каналов рассылки channel

#### Ход исследования:
1 Загрузка данных\
2 Предварительная обработка данных\
3 Объединение датафреймов, создание новых признаков и исследовательский анализ данных
4 Обучение моделей машинного обучения\
5 Оценка важности признаков\
6 Общий вывод

## Общий вывод:
1 Все данные сохранены в 5 датафреймов: ap, am, target, ce, cc.

2 Проведена предварительная обработка данных: удалены дубликаты, отчмечены аномальные значения.

3 Проведено объединение датафреймов target, am и ap в единый датафрейм df4, с удалением дубликатов, лишних столбцов и заполнением пропусков.

4 Созданы новые признаки:
4.1 year год
4.2 month месяц\
4.3 qnt_id количество id в товаре
4.4 total_in_category общее количество товаров в сообщении по категориям
4.5 first_id - первый id товара
4.6 total_in_message - общее количество товаров в сообщении
4.7 total_price - общая цена товаров в сообщении
4.8 days_span - количество дней от открытия сообщения до покупки
4.9 fl_span - количество дней активности клиента\
4.10 mean_price - средняя цена, которую платит клиент
4.11 purchase_count - количество оплат на сообщение
4.12 class_0 - непокупочные события
4.13 number_event - количество событий на клиента
4.14 days_span_am - количество дней активности на одно сообщение датафрейма am
4.15 fl_span_am - количество дней активности клиента датафрейма am
4.16 mean_purchase - среднее количество покупок за период активности
4.17 class_purchase - класс - соотношение количества товаров и покупок
4.18 kmp - коэффициент соотношения количества товаров и покупок

5 Проведен исследовательский анализ нового датафрейма:
5.1 Показателям quantity, price - наблюдается большее количество выбросов у таргета = 0, чем у таргета = 1, это м.б. объяснено тем, что значений таргет=0 количествнно больше, чем таргет=1.
5.2 Показатели year, day - нет особой разницы между знчениями таргета.
5.3 Показатель month - наблюдается разброс таргетов: 0 - 5-10 месяц, 1 - 4-11 месяц.
5.4 Количество категорий id в подавляющем большинстве случаев - 4, также встречается 3 и 5.
5.5 Данные даны за 3 года: 2024, 2023, 2022. Больше всего покупок было соверешно в 2023 году, при этом самое большое соотношение таргет 1/ таргет 0 наблюдается в 2024 году.
5.6 Во всех числовых новых показателях - наблюдается большее количество выбросов у таргета = 0, чем у таргета = 1, это м.б. объяснено тем, что значений таргет=0 количествнно больше, чем таргет=1.
5.7 Признак "channel" - если значение признака mobile_push, то соотношение target 1 / target 0 больше, чем в строках с другим значением.
5.8 Признак 'total_in_message': разброс квантилей 25-75 у таргета 1 незначительно шире, чем у таргета 0.
5.9 Признак 'total_in_price': разброс квантилей 25-75 у таргета 1 незначительно уже, чем у таргета 0.
5.10 Признак 'kmp': разброс квантилей 25-75 у таргета 1 шире, чем у таргета 0.
5.11 Признак 'number_event': разброс квантилей 25-75 у таргета 1 смещен выше, чем у таргета 0.

6 Проведена оценка корреляции между признаками: значимую корреляцию с target имеют только столбцы: fl_span и number_event.

7 Проведено обучение нескольких моделей машинного обучения: DecisionTreeClassifier, KNeighborsClassifier, LogisticRegression, LGBMClassifier, RandomForestClassifier, XGBClassifier, GradientBoostingClassifier.

8 Проведен тюнинг гиперпараметров лучшей модели XGBClassifier, характеристики лучшей модели:

'Лучшие параметры LGBMClassifier+Optuna:' {'n_estimators': 791,
'max_depth': 10,
'learning_rate': 0.028467031729880812,
'num_leaves': 57,
'min_child_samples': 37,
'min_split_gain': 0.9362236544376288,
'class_weight': 'balanced',
'verbose': -1}

'Метрики на кросс-валидации:'
'F1 score: 0.3413'
'F2 score: 0.4558'
'Accuracy: 0.9273'
'Recall: 0.5871'
'Precision: 0.2406'
'ROC AUC: 0.7628'\

'Метрики по результатам тестовой выборки:'
'F1 score: 0.3455'
'F2 score: 0.4678'
'Accuracy: 0.9255'
'Recall: 0.6124'
'Precision: 0.2406'
'ROC AUC: 0.7741'

9 Топ-12 самых важных признаков:
9.1 fl_span - количество дней активности клиента (0.38)
9.2 mean_price - средняя цена, которую приносит клиент за период активности (0.35) - чем показатель меньше, тем чаще target 1
9.3 mean_purchase - среднее количество покупок за период активности (0.27) - чем показатель меньше, тем чаще target 1
9.4 total_price - сумма, принесенная клиентом (0.23), чем она меньше, тем чаще target 1
9.5 total_in_message - общее количество товаров в сообщении (0.21) - чем показатель меньше, тем чаще target 1
9.6 kmp - коэффициент соотношения товаров и покупок (0.21) - чем он больше, тем чаще target 1
9.7 year - год (0.2), чем он больше, тем чаще target 1
9.8 first_id_4 - если первый id 4 (0.19), тем чаще target 1
9.9 number_event - количество сообщений (0.17)
9.10 month - месяц (0.16)
9.11 days_span_am - количество дней активности на одно сообщение датафрейма am (0.15)
9.12 fl_span_am - количество дней активности клиента датафрейма am (0.14)

10 Рекомендации для бизнеса:
10.1 Обратить внимание на клиентов, которые покупаеют за меньшие суммы меньшее количество товаров, но чаще.
10.2 Обратить внимание на клиентов, которые оплачивают заказанные товары.
10.3 Клиенты возвращаются в определенные месяцы.
10.4 Делать рассылки через моюильное приложение.
